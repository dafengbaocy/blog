### pipeline 

#### intro 

衡量CPU的好坏：单指令的执行周期

真正的指标：

1. 单次执行时间 
2. 吞吐量 
3. 能量消耗 :首先来自电容的充放电，还有一些泄露

CPI:Time/Program=Instructions/Program\*Cycles/Instruction*Time/Cycle

ENergy per task ：

**流水线：**就是说在运行时，有闲置的资源可以被另一个指令占满 

流水线效率是由最慢的任务或资源决定的，因此，时钟周期设定就得是最长的指令周期

#### pipeline HAZARD

如果同时执行的指令相互影响，那么就会出现一些影响，主要有3大类：

1. 结构故障：同一个资源被多个请求 

 - 解决方法 
   1. 直接让已调指令停下来 
   2. 添加更多的硬件以便于同时访问 （对于内存，就是缓存的概念）

1.  数据危险：需要时间写入、独处数据或数据以来正在执行的这一条命令 
2. 控制危险： 

#### pipeline datapath 

在每一阶段都添加一个clock 

在每一个阶段的边界尚，我们都需要添加寄存器来区分边界，每一个寄存器中饿哦们都需要保存指令和控制寄存器的值（打包）

![image-20230924180853872](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20230924180853872.png)

- **data** **hazard** （上一条指令的输出就是这一条指令的输入）

  解决：1. 停止 （通过插入气泡（也即是空指令））（所有的load指令都需要停止一个cycle）（当读取到cycle时，禁用控制寄存器写入， 抑制循环一个工作）

     2. 转发：现在正确的输出已经存在与硬件中，我门需要添加**旁路**，将其转发给下一条指令 

        实现：通过一个mux与比较器确定是否存在危险，是否需要转发

- **control** **hazard** （分支与跳跃相关）

  进阶：分支预测器（cs152）

#### 超标量处理器  

1. 提升时钟频率 

2. 提高流水线 

3. 自动重排程序（CS152）

   ![image-20230924200318531](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20230924200318531.png)

